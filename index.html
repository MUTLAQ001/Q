<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="جهّز شعبك وسجّلها بضغطة زر.">
	<meta name="theme-color" content="#0a0a0a">
	<title>مُعِدّ أداة التعبئة</title>
    <link id="favicon" rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI2ZmZiI+PHJlY3Qgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIHJ4PSI5MCIgZmlsbD0iIzBhMGEwYSIvPjxwYXRoIGQ9Ik0yMC44NTMgMTkuMTQ3YTEuMDAxIDEuMDAxIDAgMCAwLTEuNDEyIDBsLTcuNTg4LTcuNTg4TDkuNDY4IDExLjUzbDcuNTg5IDcuNTg4YTEuMDA0IDEuMDA0IDAgMCAwIDEuNDEyLjAwMWwuMzg0LS4zODNhMSAxIDAgMCAwIDAtMS40MTVsLTIuOTU0LTIuOTU0IDEuNTM2LTEuNTM2IDMuNjY4IDMuNjY3YTEgMSAwIDAgMCAxLjQxNC0xLjQxNGwtMy42NjctMy42NjggMS41MTctMS41MTggMi45NTQgMi45NTRhMSAxIDAgMCAwIDEuNDE0IDBsLjM4My0uMzg0YTEgMSAwIDAgMCAwLTEuNDE0bC03LjU4OC03LjU4OEwzLjEzMiAxNS4yNThhMSAxIDAgMCAwIDAgMS40MTRsMi40NzUgMi40NzVhMSAxIDAgMCAwIDEuNDE0IDBsMi44MjItMi44MjIgMS40NjQgMS40NjQtMi44MjEgMi44MjFhMSAxIDAgMCAwIDAgMS40MTRsMi40NzUgMi40NzVhMSAxIDAgMCAwIDEuNDE0IDBMMTMuODY5IDE5LjVsMi44MjEgMi44MjFhMSAxIDAgMCAwIDEuNDE0IDBsMi43NS0yLjczWm0tOS41MDItMTIuMDYxIDIuMTIyIDIuMTIxLTMuNTU2IDMuNTU2LTIuMTIyLTIuMTIxWm0tMy45MTMgMy45MTMgMi4xMjEgMi4xMjItNi43MTcgNi43MTctMi4xMjItMi4xMjFaTTUuNTYxIDE0LjE4MmwyLjEyMSAyLjEyMSA0Ljk1IDQuOTUtMi4xMjEgMi4xMjEtLjcxNC0uNzE3LTQuMjM4LTQuMjM4Wm0xMC41NDgtOC4xMzJhMSAxIDAgMSAwLTEuNDE0LTEuNDE0IDEgMSAwIDAgMCAxLjQxNCAxLjQxNFoiLz48L3N2Zz4=">
	<link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI2ZmZiI+PHJlY3Qgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1ليIiIHJ4PSI5MCIgZmlsbD0iIzBhMGEwYSIvPjxwYXRoIGQ9Ik0yMC44NTMgMTkuMTQ3YTEuMDAxIDEuMDAxIDAgMCAwLTEuNDEyIDBsLTcuNTg4LTcuNTg4TDkuNDY4IDExLjUzbDcuNTg5IDcuNTg4YTEuMDA0IDEuMDA0IDAgMCAwIDEuNDEyLjAwMWwuMzg0LS4zODNhMSAxIDAgMCAwIDAtMS40MTVsLTIuOTU0LTIuOTU0IDEuNTM2LTEuNTM2IDMuNjY4IDMuNjY3YTEgMSAwIDAgMCAxLjQxNC0xLjQxNGwtMy42NjctMy42NjggMS41MTctMS41MTggMi45NTQgMi45NTRhMSAxIDAgMCAwIDEuNDE0IDBsLjM4My0uMzg0YTEgMSAwIDAgMCAwLTEuNDE0bC03LjU4OC03LjU4OEwzLjEzMiAxNS4yNThhMSAxIDAgMCAwIDAgMS40MTRsMi40NzUgMi40NzVhMSAxIDAgMCAwIDEuNDE0IDBsMi44MjItMi44MjIgMS40NjQgMS40NjQtMi44MjEgMi44MjFhMSAxIDAgMCAwIDAgMS40MTRsMi44MjEgMi44MjFhMSAxIDAgMCAwIDEuNDE0IDBsMi43NS0yLjczWm0tOS41MDItMTIuMDYxIDIuMTIyIDIuMTIxLTMuNTU2IDMuNTU2LTIuMTIyLTIuMTIxWm0tMy45MTMgMy45MTMgMi4xMjEgMi4xMjItNi43MTcgNi43MTctMi4xMjItMi4xMjFaTTUuNTYxIDE0LjE4MmwyLjEyMSAyLjEyMSA0Ljk1IDQuOTUtMi4xMjEgMi4xMjEtLjcxNC0uNzE3LTQuMjM4LTQuMjM4Wm0xMC41NDgtOC4xMzJhMSAxIDAgMSAwLTEuNDE0LTEuNDE0IDEgMSAwIDAgMCAxLjQxNCAxLjQxNFoiLz48L3N2Zz4=">
	<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
	<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
	<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">
	<style>
		@import url("https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap");
		@import url("https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;700&display=swap");
		:root{--color-primary:#5e9cff;--color-primary-dark:#4b7dcc;--color-bg:#0a0a0a;--color-card:rgba(20,20,22,0.75);--color-border:rgba(255,255,255,0.1);--color-text:#e0e0e0;--color-text-muted:#999;--font-body:"Cairo",sans-serif;--font-title:"IBM Plex Sans Arabic",sans-serif;--radius:20px;--radius-md:16px;--radius-full:999px;--transition:0.3s cubic-bezier(0.25,0.8,0.25,1);--transition-smooth:0.5s cubic-bezier(0.2,0.8,0.2,1);--rgb-primary:94,156,255;--primary-hue:217;--secondary-hue:257;}
		* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
		html{ scroll-behavior:smooth; scrollbar-width: none; }
		body.modal-open { overflow: hidden !important; }
		body{font-family:var(--font-body);background-color:var(--color-bg);color:var(--color-text);direction:rtl;overflow-x:hidden;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale; transition: background-color var(--transition-smooth), color var(--transition-smooth);}
		::-webkit-scrollbar { display: none; }
        @keyframes gradient-animation{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
		@keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
		@keyframes scaleIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
        @keyframes fadeIn{from{opacity:0}to{opacity:1}}
		@keyframes move-nebula{0%{transform:translate(0,0) rotate(0deg) scale(1.2)}50%{transform:translate(10vw,5vh) rotate(180deg) scale(1.5)}100%{transform:translate(0,0) rotate(360deg) scale(1.2)}}
		*:focus-visible{outline:2px solid var(--color-primary);outline-offset:3px;border-radius:6px}
        .cosmic-bg-container{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-2;overflow:hidden}
		#starfield-canvas{position:absolute;top:0;left:0;width:100%;height:100%}
		.nebula-glow{position:absolute;top:50%;left:50%;width:80vmax;height:80vmax;margin-top:-40vmax;margin-left:-40vmax;background:radial-gradient(circle,hsl(var(--primary-hue),90%,60%,.15) 0%,hsl(var(--secondary-hue),80%,50%,.1) 40%,transparent 70%);filter:blur(100px);border-radius:50%;animation:move-nebula 90s infinite alternate ease-in-out;}
        .app{min-height:100vh;position:relative;padding:2rem 1rem 6rem 1rem; display: flex; align-items: center; justify-content: center;}
		.container{width:100%;max-width:600px;z-index:1;display:flex;flex-direction:column;gap:1.5rem;margin:0 auto;position:relative}
		.header{text-align:center;animation:fadeInUp .8s var(--transition-smooth) both}
		.title{font-family:var(--font-title);font-weight:700;font-size:2.8rem;margin-bottom:0.25rem;background:linear-gradient(90deg,var(--color-primary-dark),var(--color-primary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-size:200% 200%;animation:gradient-animation 5s ease-in-out infinite; display: flex; align-items: center; justify-content: center; gap: 0.75rem;}
		.subtitle{color:var(--color-text-muted);font-size:1rem;animation:fadeInUp .8s var(--transition-smooth) .2s both; letter-spacing: 0.5px;}
        .card{background:var(--color-card);border:1px solid var(--color-border);border-radius:var(--radius);padding:1.5rem;backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);position:relative;animation:scaleIn .8s var(--transition-smooth) .4s both;box-shadow: 0 16px 40px -12px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.05);}
        .input-grid{display: grid; grid-template-columns: 1fr; gap: 1.5rem; margin-top: 1.5rem;}
        .input-group label{display:flex;align-items:center;gap:0.5rem;font-size:1.1rem;color:var(--color-text);margin-bottom: 0.75rem; font-weight: 600;}
        .input-group label i { color: var(--color-primary); }
		.input-group textarea{width:100%;background:rgba(0,0,0,0.3);border:1px solid var(--color-border);border-radius:var(--radius-md);padding:.9rem 1.2rem;color:var(--color-text);font-family:var(--font-body);font-size:1rem;transition: all var(--transition); resize: vertical; min-height: 140px;}
		.input-group textarea:focus{outline:none;border-color:var(--color-primary);box-shadow:0 0 0 3px rgba(var(--rgb-primary), 0.4);}
        .action-button{width:100%;padding:1rem;font-family:var(--font-title);font-size:1.1rem;font-weight:700;border:none;border-radius:var(--radius-full);cursor:pointer;background:linear-gradient(90deg,var(--color-primary-dark),var(--color-primary));color:#fff;transition:all .2s ease-in-out;display:flex;justify-content:center;align-items:center;gap:.75rem;user-select:none; margin-top: 1.5rem; box-shadow: 0 4px 15px rgba(var(--rgb-primary),0.2);}
		.action-button:hover{transform:translateY(-3px);box-shadow:0 8px 25px rgba(var(--rgb-primary),0.3); filter: brightness(1.1);}
        .bookmarklet-result-section{display:flex; flex-direction: column; align-items:center;gap:1rem;margin-top:1.5rem;padding:1.5rem;border-radius:var(--radius);animation:fadeInUp .6s ease both;transition:background .4s ease;background:radial-gradient(circle,rgba(var(--rgb-primary),0.1) 0%,transparent 70%),rgba(0,0,0,0.2); border: 1px solid var(--color-border);}
        .bookmarklet-result-section p { font-size: 1rem; font-weight: 600; color: var(--color-text-muted); line-height: 1.6; }
        .bookmarklet-link { display: inline-block; background: var(--color-primary); color: white; padding: 12px 24px; border-radius: var(--radius-full); font-weight: bold; text-decoration: none; cursor: grab; box-shadow: 0 4px 15px rgba(var(--rgb-primary), 0.3); transition: all 0.3s ease; display:flex; align-items:center; gap: 0.75rem;}
        .bookmarklet-link:hover { transform: translateY(-3px) scale(1.05); filter: brightness(1.1); box-shadow: 0 8px 25px rgba(var(--rgb-primary), 0.4); }
		.footer{position: fixed; bottom: 0; left: 0; right: 0; padding: 1rem; display:flex;justify-content:center;align-items:center;}
        .footer-content { background: var(--color-card); border: 1px solid var(--color-border); border-radius: var(--radius-full); padding: 0.5rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem; backdrop-filter:blur(16px); -webkit-backdrop-filter:blur(16px); box-shadow: 0 8px 30px rgba(0,0,0,0.3); animation: fadeInUp 0.8s var(--transition-smooth) 0.6s both; }
		.footer-icon-btn {background: transparent; border: none; color: var(--color-text-muted); font-size: 1.5rem; cursor: pointer; transition: all 0.2s ease-in-out; display: inline-flex; align-items: center; justify-content: center; width: 44px; height: 44px; border-radius: 50%; text-decoration: none;}
		.footer-icon-btn:hover {color: var(--color-primary); background-color: rgba(var(--rgb-primary), 0.1); transform: scale(1.1);}
        .mode-toggle { display: flex; background: rgba(0,0,0,0.3); border: 1px solid var(--color-border); border-radius: var(--radius-full); padding: 4px; gap: 4px; }
		.mode-btn { padding: 0.4rem 1rem; border: none; border-radius: var(--radius-full); font-family: var(--font-body); font-size: 0.9rem; font-weight: 600; cursor: pointer; background: transparent; color: var(--color-text-muted); transition: all 0.2s ease; user-select: none; }
		.mode-btn.active { background: var(--color-primary); color: #fff; box-shadow: 0 2px 5px rgba(var(--rgb-primary), 0.2); }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); z-index: 1000; display: flex; justify-content: center; align-items: center; opacity: 0; animation: fadeIn .3s ease forwards; }
		.modal-content { background: var(--color-card); border: 1px solid var(--color-border); border-radius: var(--radius); padding: 1.5rem; width: 90%; max-width: 500px; z-index: 1001; transform: scale(0.95); opacity: 0; animation: scaleIn .3s .1s ease forwards; position: relative; backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px); }
		.modal-close-btn { position: absolute; top: 1rem; left: 1rem; background: none; border: none; color: var(--color-text-muted); font-size: 1.8rem; cursor: pointer; transition: var(--transition); padding: 0.25rem; line-height: 1; }
		.modal-close-btn:hover { color: #fff; transform: rotate(90deg); }
		.modal-header { font-family: var(--font-title); font-size: 1.5rem; color: #fff; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--color-border); }
        .settings-content { display: flex; flex-direction: column; gap: 1.5rem; text-align: right; }
		.settings-section-title { font-family: var(--font-title); font-size: 1.2rem; color: var(--color-primary); margin-bottom: 0; padding-bottom: 0.75rem; border-bottom: 1px solid var(--color-border); }
        .settings-item { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 1rem; }
        .settings-item h4 { font-family: var(--font-body); font-weight: 600; font-size: 1rem; color: var(--color-text); margin: 0; }
		.theme-picker{display:flex;gap:.5rem;align-items:center; flex-shrink: 0;}
		.theme-dot{width:24px;height:24px;border-radius:50%;cursor:pointer;transition:transform .2s ease, border-color .2s ease;border:2px solid transparent}
		.theme-dot:hover{transform:scale(1.2)}
		.theme-dot.active{border-color:#fff; transform: scale(1.1);}
        .color-picker-label { position: relative; width: 24px; height: 24px; border-radius: 50%; cursor: pointer; transition: all .2s ease; border: 2px solid var(--color-border); user-select: none; overflow: hidden; }
        .color-picker-label:hover { transform: scale(1.2); }
        .color-picker-label.active { border-color: #fff; transform: scale(1.1); }
        .color-picker-input { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; border: none; padding: 0; cursor: pointer; }
        .swal2-popup{background:var(--color-card)!important;color:var(--color-text)!important;border-radius:var(--radius)!important;border:1px solid var(--color-border)!important; backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);}
		.swal2-title{color:var(--color-text)!important; font-family: var(--font-title) !important;}
		.swal2-html-container{color:var(--color-text-muted)!important; margin: 1em 0 !important; font-size: 1em !important; display: block !important; text-align: right !important;}
		.swal2-confirm{background:var(--color-primary)!important;border-radius:var(--radius-full)!important;padding:.6rem 1.5rem!important;font-family:var(--font-body)!important;}
		.swal2-confirm:focus{box-shadow:0 0 0 3px rgba(var(--rgb-primary),0.5)!important}
        .light-mode { --color-bg: #f9f9f9; --color-card: rgba(255, 255, 255, 0.75); --color-border: rgba(0, 0, 0, 0.09); --color-text: #202020; --color-text-muted: #707070; }
        .light-mode .nebula-glow { opacity:.5; filter:blur(120px); }
        .light-mode .card, .light-mode .footer-content { box-shadow: 0 16px 40px -12px rgba(0,0,0,0.1); }
        .light-mode .modal-header, .light-mode .settings-item h4 { color: var(--color-text); }
        .light-mode .input-group textarea { background: rgba(0,0,0,0.04); border-color: rgba(0,0,0,0.08); color: var(--color-text); }
		.light-mode .input-group textarea:focus { background-color: rgba(255,255,255,0.5); border-color: var(--color-primary); }
        .light-mode .mode-toggle { background: rgba(0,0,0,0.04); border-color: rgba(0,0,0,0.08); }
        .light-mode .theme-dot.active, .light-mode .color-picker-label.active { border-color: var(--color-text); }
        .light-mode .modal-overlay { background-color: rgba(0, 0, 0, 0.15); }
		.light-mode .modal-close-btn:hover { color: var(--color-text); }
		@media (min-width: 768px) { .input-grid { grid-template-columns: 1fr 1fr; } }
	</style>
</head>
<body>
    <div class="cosmic-bg-container">
        <div class="nebula-glow"></div>
        <canvas id="starfield-canvas"></canvas>
    </div>

	<noscript>You need to enable JavaScript to run this app.</noscript>
	<div id="root"></div>

	<script type="text/babel">
		const { useState, useEffect, useCallback, StrictMode } = React;
        const { createPortal } = ReactDOM;

        // --- Custom Hooks & Utilities ---
		const useLocalStorage = (key, defaultValue) => {
			const [value, setValue] = useState(() => {
				try { const saved = localStorage.getItem(key); return saved ? JSON.parse(saved) : defaultValue; }
				catch (error) { return defaultValue; }
			});
			useEffect(() => { localStorage.setItem(key, JSON.stringify(value)); }, [key, value]);
			return [value, setValue];
		};

        function hexToRgb(hex) {
            let result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : '94,156,255';
        }

        function adjustColorBrightness(hex, percent) {
            let r = parseInt(hex.slice(1, 3), 16), g = parseInt(hex.slice(3, 5), 16), b = parseInt(hex.slice(5, 7), 16);
            const p = percent / 100;
            r = Math.min(255, Math.max(0, Math.round(r * (1 + p))));
            g = Math.min(255, Math.max(0, Math.round(g * (1 + p))));
            b = Math.min(255, Math.max(0, Math.round(b * (1 + p))));
            return `#${(r).toString(16).padStart(2, '0')}${(g).toString(16).padStart(2, '0')}${(b).toString(16).padStart(2, '0')}`;
        }

		const hexToHue = H => {
			if (!H) return 217; let r=0,g=0,b=0; if(H.length==7){r="0x"+H[1]+H[2];g="0x"+H[3]+H[4];b="0x"+H[5]+H[6];} r/=255;g/=255;b/=255; let cmin=Math.min(r,g,b),cmax=Math.max(r,g,b),delta=cmax-cmin,h=0; if(delta==0)h=0; else if(cmax==r)h=((g-b)/delta)%6; else if(cmax==g)h=(b-r)/delta+2; else h=(r-g)/delta+4; h=Math.round(h*60); if(h<0)h+=360; return h;
		};

        // --- Components ---
        function SettingsModal({ isOpen, onClose, theme, setTheme, colorMode, setColorMode }) {
			if (!isOpen) return null;
            const isCustomTheme = !Object.values(PRESET_THEMES).includes(theme);
			return createPortal(
				<div className="modal-overlay" onClick={(e) => e.target === e.currentTarget && onClose()}>
					<div className="modal-content">
						<button onClick={onClose} className="modal-close-btn" title="إغلاق"><i className="ri-close-line"></i></button>
						<h2 className="modal-header">الإعدادات</h2>
                        <div className="settings-content">
                            <h3 className="settings-section-title">مظهر التطبيق</h3>
                            <div className="settings-item">
                                <h4>الوضع</h4>
                                <div className="mode-toggle">
                                    <button className={`mode-btn ${colorMode === 'dark' ? 'active' : ''}`} onClick={() => setColorMode('dark')}>ظلام</button>
                                    <button className={`mode-btn ${colorMode === 'light' ? 'active' : ''}`} onClick={() => setColorMode('light')}>نهار</button>
                                </div>
                            </div>
                            <div className="settings-item">
                                <h4>اختر السمة</h4>
                                <div className="theme-picker">
                                    {Object.entries(PRESET_THEMES).map(([name, color]) => (
                                        <div key={name} className={`theme-dot ${theme === color ? 'active' : ''}`} style={{ backgroundColor: color }} onClick={() => setTheme(color)} />
                                    ))}
                                    <label htmlFor="custom-color-picker" className={`color-picker-label ${isCustomTheme ? 'active' : ''}`} title="اختر لونًا مخصصًا" style={{ backgroundColor: isCustomTheme ? theme : 'transparent' }}>
                                        <input id="custom-color-picker" type="color" className="color-picker-input" value={theme} onChange={(e) => setTheme(e.target.value)} />
                                    </label>
                                </div>
                            </div>
                        </div>
					</div>
				</div>,
				document.body
			);
		}

		const PRESET_THEMES = { blue: '#5e9cff', purple: '#a777ff', green: '#00c853' };

		function App() {
            const [regularSections, setRegularSections] = useState('');
            const [freeSections, setFreeSections] = useState('');
            const [bookmarkletComponent, setBookmarkletComponent] = useState(null);
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);
            const [theme, setTheme] = useLocalStorage('fillerTheme', PRESET_THEMES.blue);
            const [colorMode, setColorMode] = useLocalStorage('fillerColorMode', 'dark');

			useEffect(() => {
                const primaryColor = theme; const darkColor = adjustColorBrightness(primaryColor, -20); const rgbColor = hexToRgb(primaryColor); const primaryHue = hexToHue(primaryColor); const secondaryHue = (primaryHue + 40) % 360;
                document.documentElement.style.setProperty('--color-primary', primaryColor); document.documentElement.style.setProperty('--color-primary-dark', darkColor); document.documentElement.style.setProperty('--rgb-primary', rgbColor); document.documentElement.style.setProperty('--primary-hue', String(primaryHue)); document.documentElement.style.setProperty('--secondary-hue', String(secondaryHue));
			}, [theme]);
			
			useEffect(() => {
				document.body.className = colorMode === 'light' ? 'light-mode' : '';
				const themeColorMeta = document.querySelector('meta[name="theme-color"]');
				if (themeColorMeta) { themeColorMeta.setAttribute('content', colorMode === 'light' ? '#f9f9f9' : '#0a0a0a'); }
			}, [colorMode]);

            const handleGenerateClick = useCallback(() => {
                const regularArray = regularSections.split(/[\n\s,]+/).map(s => s.trim()).filter(Boolean);
                const freeArray = freeSections.split(/[\n\s,]+/).map(s => s.trim()).filter(Boolean);

                const bookmarkletLogic = `
                    (function() {
                        'use strict';
                        const regular = ${JSON.stringify(regularArray)};
                        const free = ${JSON.stringify(freeArray)};
                        let filled = 0, notFound = 0;
                        function fill(p, s) {
                            for (let i = 0; i < s.length; i++) {
                                const el = document.getElementById(p + 'Section' + i);
                                if (el) { el.value = s[i]; el.dispatchEvent(new Event('blur',{bubbles:true})); el.dispatchEvent(new Event('keyup',{bubbles:true})); filled++; } else { notFound++; break; }
                            }
                        }
                        fill('add', regular); fill('free', free);
                        alert("تمت محاولة ملء " + filled + " شعبة." + (notFound > 0 ? "\\nلم يتم العثور على " + notFound + " خانة." : "") + "\\nيرجى الانتظار لتحميل التفاصيل.");
                    })();
                `;

                const encodedLogic = "javascript:" + encodeURIComponent(bookmarkletLogic.replace(/\s{2,}/g, ' '));
                
                const onLinkClick = (e) => {
                    e.preventDefault();
                    Swal.fire({
                        title: 'خطأ في الاستخدام!',
                        html: '<p style="color: var(--color-text-muted); text-align: right;">لا تضغط على الزر هنا. يجب عليك <strong>سحبه بزر الماوس</strong> وإفلاته في شريط الإشارات المرجعية (Bookmarks Bar) في أعلى المتصفح.</p>',
                        icon: 'warning',
                        confirmButtonText: 'حسنًا، فهمت'
                    });
                };
                
                setBookmarkletComponent(
                    <a href={encodedLogic} className="bookmarklet-link" onClick={onLinkClick}>
                        <i className="ri-drag-move-2-line"></i>
                        <span>اسحبني إلى شريط الإشارات</span>
                    </a>
                );
            }, [regularSections, freeSections]);

			return (
				<div className="app">
					<div className="container">
						<header className="header">
							<h1 className="title"><i className="ri-magic-line"></i> مُعِدّ أداة التعبئة</h1>
							<p className="subtitle">جهّز شعبك، اسحب الأداة، وسجّلها بضغطة زر</p>
						</header>

                        <div className="card">
                            <div className="input-grid">
                                <div className="input-group">
                                    <label htmlFor="regular-sections-input"><i className="ri-list-check-3"></i> الشعب العادية</label>
                                    <textarea 
                                        id="regular-sections-input"
                                        value={regularSections}
                                        onChange={e => setRegularSections(e.target.value)}
                                        placeholder="مثال:&#10;3333&#10;1122&#10;4567"
                                    />
                                </div>
                                <div className="input-group">
                                    <label htmlFor="free-sections-input"><i className="ri-award-line"></i> الشعب الحرة</label>
                                    <textarea
                                        id="free-sections-input"
                                        value={freeSections}
                                        onChange={e => setFreeSections(e.target.value)}
                                        placeholder="مثال:&#10;8899&#10;7766"
                                    />
                                </div>
                            </div>

                            <button className="action-button" onClick={handleGenerateClick}>
                                <i className="ri-sparkling-2-line"></i>
                                أنشئ أداة التعبئة
                            </button>
                        </div>
						
                        {bookmarkletComponent && (
                            <div className="bookmarklet-result-section">
                                <p>الخطوة الأخيرة: اسحب الزر التالي وأفلته في شريط الإشارات المرجعية</p>
                                {bookmarkletComponent}
                            </div>
                        )}
					</div>
					<footer className="footer">
                        <div className="footer-content">
                            <div className="mode-toggle">
                                <button className={`mode-btn ${colorMode === 'dark' ? 'active' : ''}`} onClick={() => setColorMode('dark')}>ظلام</button>
                                <button className={`mode-btn ${colorMode === 'light' ? 'active' : ''}`} onClick={() => setColorMode('light')}>نهار</button>
                            </div>
                            <button onClick={() => setIsSettingsOpen(true)} className="footer-icon-btn" title="الإعدادات">
                                <i className="ri-settings-3-line"></i>
                            </button>
                            <a href="https://t.me/mutlaq1" className="footer-icon-btn" target="_blank" rel="noopener noreferrer" title="تواصل معي على تليجرام">
                                <i className="ri-telegram-line"></i>
                            </a>
                        </div>
					</footer>
                    <SettingsModal 
                        isOpen={isSettingsOpen} 
                        onClose={() => setIsSettingsOpen(false)} 
                        theme={theme}
                        setTheme={setTheme}
                        colorMode={colorMode}
                        setColorMode={setColorMode}
                    />
				</div>
			);
		}
		
        const swalTheme = { background: 'var(--color-card)', color: 'var(--color-text)', confirmButtonColor: 'var(--color-primary)', customClass: { popup: 'swal2-popup', confirmButton: 'swal2-confirm', title: 'swal2-title', htmlContainer: 'swal2-html-container' } };
        Swal.update(swalTheme);
		const root = ReactDOM.createRoot(document.getElementById("root"));
		root.render(<StrictMode><App /></StrictMode>);
	</script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const initCosmicEffects = () => {
            const canvas = document.getElementById('starfield-canvas'); if (!canvas) return;
            const ctx = canvas.getContext('2d');
            let stars = [];
            function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
            class Star { constructor() { this.reset(); } reset() { this.x = Math.random() * canvas.width; this.y = Math.random() * canvas.height; this.z = Math.random() * canvas.width; this.speed = 0.05 + this.z / canvas.width * 0.2; this.radius = this.z / canvas.width * 1.2; } update() { this.z -= this.speed; if (this.z < 1) { this.z = canvas.width; this.x = Math.random() * canvas.width; this.y = Math.random() * canvas.height; } } draw() { const x = (this.x - canvas.width / 2) * (canvas.width / this.z) + canvas.width / 2; const y = (this.y - canvas.height / 2) * (canvas.width / this.z) + canvas.height / 2; const radius = this.radius * (canvas.width / this.z); ctx.beginPath(); ctx.arc(x, y, radius, 0, Math.PI * 2); ctx.fillStyle = 'rgba(220, 220, 255, 0.7)'; ctx.fill(); } }
            function initStars() { stars = []; for (let i = 0; i < (canvas.width * canvas.height / 4000); i++) { stars.push(new Star()); } }
            function animate() { requestAnimationFrame(animate); ctx.clearRect(0, 0, canvas.width, canvas.height); stars.forEach(s => { s.update(); s.draw(); }); }
            window.addEventListener('resize', () => { resizeCanvas(); initStars(); });
            resizeCanvas(); initStars(); animate();
        };
        initCosmicEffects();
    });
    </script>
</body>
</html>
